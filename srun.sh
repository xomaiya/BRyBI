#!/bin/bash
set -e


TIME="3-00:00:00"
CPUS="24"
PARTITION="normal"
config="--partition $PARTITION --cpus-per-task $CPUS --time $TIME"

#TIME="3-00:00:00"
#CPUS="64"
#MEM="512G"
#PARTITION="ais-cpu"
#config="--partition $PARTITION --cpus-per-task $CPUS --mem $MEM --time $TIME"

DATASET="../data/dataset"
RESULTS="../data/results"

SUB_DATASETS=(
  "temporally_segmented/1.8/40"
  "temporally_segmented/1.8/50"
  "temporally_segmented/1.8/60"
  "temporally_segmented/1.8/100"
  "temporally_segmented/1.8/150"
  "temporally_segmented/1.8/200"
  "temporally_segmented/1.8/300"
  "cs_fixed_rhythm/500"
  "temporally_segmented/1.8/400"
  "temporally_segmented/1.8/500"
  "csbw_fixed_rhythm/1333"
  "cs_fixed_rhythm/400"
  "temporally_segmented/1.0/40"
  "temporally_segmented/1.0/50"
  "temporally_segmented/1.0/60"
  "temporally_segmented/1.0/100"
  "temporally_segmented/1.0/150"
  "temporally_segmented/1.0/200"
  "temporally_segmented/1.0/300"
  "temporally_segmented/1.0/400"
  "csbw_natural_rhythm/4.5"
  "temporally_segmented/1.0/500"
  "csbw_fixed_rhythm/1000"
  "cs_fixed_rhythm/333"
  "csbw_natural_rhythm/4.0"
  "csbw_natural_rhythm/3.5"
  "temporally_segmented/0.4/40"
  "temporally_segmented/0.4/50"
  "temporally_segmented/0.4/60"
  "temporally_segmented/0.4/100"
  "temporally_segmented/0.4/150"
  "temporally_segmented/0.4/200"
  "temporally_segmented/0.4/300"
  "temporally_segmented/0.4/400"
  "csbw_natural_rhythm/3.0"
  "temporally_segmented/0.4/500"
  "cs_fixed_rhythm/250"
  "csbw_fixed_rhythm/666"
  "csbw_natural_rhythm/2.5"
  "cs_fixed_rhythm/200"
  "csbw_natural_rhythm/2.0"
  "original"
  "interrupted_speech/0.5/100"
  "interrupted_speech/0.5/1"
  "interrupted_speech/0.5/5"
  "interrupted_speech/0.5/500"
  "interrupted_speech/0.75/100"
  "interrupted_speech/0.75/1"
  "interrupted_speech/0.75/5"
  "interrupted_speech/0.75/500"
  "interrupted_speech/0.125/100"
  "interrupted_speech/0.125/1"
  "interrupted_speech/0.125/5"
  "interrupted_speech/0.125/500"
  "interrupted_speech/0.25/100"
  "interrupted_speech/0.25/1"
  "interrupted_speech/0.25/5"
  "interrupted_speech/0.25/500"
  "interrupted_speech/0.625/100"
  "interrupted_speech/0.625/1"
  "interrupted_speech/0.625/5"
  "interrupted_speech/0.625/500"
  "csbw_fixed_rhythm/500"
  "cs_fixed_rhythm/166"
  "csbw_natural_rhythm/1.5"
  "cs_fixed_rhythm/142"
  "csbw_natural_rhythm/1.0"
  "simply_compressed/1.5"
  "simply_compressed/2"
  "csbw_natural_rhythm/0.5"
  "cs_fixed_rhythm/83"
  "csbw_fixed_rhythm/250"
  "simply_compressed/2.5"
  "csbw_fixed_rhythm/166"
  "cs_natural_rhythm/0.5"
  "cs_natural_rhythm/1.5"
  "cs_natural_rhythm/2.5"
  "cs_natural_rhythm/1.0"
  "cs_natural_rhythm/4.0"
  "cs_natural_rhythm/3.5"
  "cs_natural_rhythm/2.0"
  "cs_natural_rhythm/4.5"
  "cs_natural_rhythm/3.0"
  "comp"
  "simply_compressed/3"
  "simply_compressed/3.5"
  "simply_compressed/4"
)


logs_subfolder=`date +"%Y-%m-%d_%T"`
logs_folder="../data/logs/$logs_subfolder"
mkdir -p "$logs_folder"
echo "Folder with logs: '$logs_folder'"

for sub_dataset in "${SUB_DATASETS[@]}"
do
    srun $config -- \
        ./run_for_dataset.sh $DATASET/$sub_dataset $RESULTS/$sub_dataset  > "$logs_folder/${sub_dataset//\//_}" &
    sleep .3
done
